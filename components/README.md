# Components

Custom FarmData2 Vue Components.

- Create a directory for each component
  - `.vue` file for the component
  - `.comp.cy.js` files for the component tests

## Component Structure

### Template

- Each component will be one or more [_Form Group_](https://bootstrap-vue-next.github.io/bootstrap-vue-next/docs/components/form-group) elements.

  - the label for a required input element is followed by `<sup v-if="required" class="text-danger">*</sup>`.
  - `id` must be set for each input element.
  - every input element must have a `data-cy` attribute.
  - `aria-describedby` must be set for each input element.
  - `BRow` and `BCol` can be used to create more complex layouts.
  - `BFormSelect` elements should begin with `{ value: null, text: '' }`.
    - to allow them to be blank when form is reset.

- All testable elements in the component must have a `data-cy` attribute.

### Script

- elements of the script should be in the order:

  - name
  - components
  - emits
  - props
  - data
  - computed
  - methods
  - created

- All components must have a `required` prop.

  - Indicates that inputs are required field if present.
  - required fields are indicated by a red asterisk
    - use `v-show` so that spacing is the same whether it is there or not.

- Components manage props, state and events to allow page to change state via the prop.

  - The component provides a prop for every value that is collected by the component
  - The component watches the props and the state variables that are v-modeled to input elements
  - When a value that a component collects changes, the component emits an `updated:prop_name` event with a payload giving the new value of the prop.
  - The entry point should `v-model` the prop to an element in `data.form`

- All events emitted must be kabob-case.
- All components must emit `ready` event when they are ready to be used in tests.

  - e.g. any API calls that were made in `created` have completed.

- If an error occurs, the component must emit an `error` event with a `String` message as the payload.

  - The entrypoint will handle the error.

## Component Testing

- use `bin/test.bash`

  - `test.bash --comp --gui` - initially to run individual tests.
  - `test.bash --comp --glob="**/CompName/*.comp.cy.js"` - to run all test on the component headless.

- Every component should have tests that:

  - These should be in approximately the order they can be written as a new component is created.

  - check static content (`*.content.comp.cy.js`)

    - check the default configuration of the component (i.e. no props set)
      - e.g. check that all of the `data-cy` elements exist / `have.text` / `have .value` (as appropriate)
    - check that content set by static props (i.e. not watched)
      - e.g. check that the required element indicators are not present by default but can be added using the `required` prop.
    - NOTE: Do not test content that relies on watched props or API requests.

  - check events (`*.events.comp.cy.js`)

    - test the `ready` event
      - ie. check that data is populated into elements (e.g. by API call) after `ready` is emitted.
    - check watched props

      - i.e. check that changing each watched prop has the desired effect in the component.

      ```JavaScript
      it.only('Verify that `selected` prop is watched', () => {
        const readySpy = cy.spy().as('readySpy');
        const updateSpy = cy.spy().as('updateSpy');

        cy.mount(CropSelector, {
          props: {
            onReady: readySpy,
            'onUpdate:selected': updateSpy,
            selected: null,
          },
        }).then(({ wrapper }) => {
          cy.get('@readySpy').should('have.been.calledOnce').then(() => {
            wrapper.setProps({ selected: 'ARUGULA' });
            cy.get('@updateSpy').should('have.been.calledOnce');
            cy.get('[data-cy="crop-select"]').should('have.value', 'ARUGULA');
          });
        });
      });
      ```

    - check that all other events are emitted properly
      - i.e. do something to cause the event and check that it is emitted properly and has the correct payload.
      - include all error events (including network errors) are emitted properly
        - i.e. Use `cy.intercept` to generate network errors on the appropriate route.

  - check other behaviors (`*.behavior.comp.cy.js`)

    - check that actions in the component have the proper effect.
      - e.g. clicking buttons, validating value (required, length, values, format, etc.) etc.
    - Note: do not retest things tested in events.

## Documenting components

- docs are in `docs/components`

- to generate docs

  - `npm run doc:gen`

- to view docs

  - `npm run doc:view`

- Docs are generated by [vue-docgen-cli](https://vue-styleguidist.github.io/docs/Docgen.html#api)
  - [Documenting Components](https://vue-styleguidist.github.io/docs/Documenting.html)

### Documentation Conventions

- List all minimum expectations here...

Inside the script, after the imports and just before the `export default {` line:

- First line of this comment must be a one sentence description that will appear in the index doc.
- This block should give an example of how to place the component in a page.
- This block must document the data-cy attributes of the component.

````Javascript
/**
 * This component does blah blah blah...
 *
 * More description of the component can go here...
 *
 * ## Example
 *
 * ```html
 * Give example of tag for using component in a page.
 * ```
 *
 * ## `data-cy` Attributes
 *
 * Attribute Name        | Description
 * ----------------------| -----------
 * `data-cy-att-name`    | Identify the element tagged with the attribute.
 * `another-one`         | Blah blah.
 */
````

### Props

- every prop gets a comment
- if the prop is watched the comment should indicate this.
- if the prop is _deep_ watched the comment should indicate this.

### Events

- every event gets a comment. If the same event is emitted multiple times, just the first one gets a comment.
- If the event hasa payload it must include an `@property` tag describing the payload.

### Methods / Computed / Watch

- these are not user facing and are not included in the docs.
- comments in the code can still be helpful to anyone modifying the component.
